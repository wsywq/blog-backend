<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.blog.mapper.ArticleMapper">

    <!-- 分页查询已发布的文章 -->
    <select id="selectPublishedArticles" resultType="com.blog.entity.Article">
        SELECT * FROM articles 
        WHERE status = 'PUBLISHED' 
        ORDER BY create_time DESC
    </select>

    <!-- 根据分类ID分页查询文章 -->
    <select id="selectByCategoryId" resultType="com.blog.entity.Article">
        SELECT * FROM articles 
        WHERE status = 'PUBLISHED' AND category_id = #{categoryId}
        ORDER BY create_time DESC
    </select>

    <!-- 根据标签ID分页查询文章 -->
    <select id="selectByTagId" resultType="com.blog.entity.Article">
        SELECT DISTINCT a.* FROM articles a
        INNER JOIN article_tags at ON a.id = at.article_id
        WHERE a.status = 'PUBLISHED' AND at.tag_id = #{tagId}
        ORDER BY a.create_time DESC
    </select>

    <!-- 搜索文章 -->
    <select id="searchArticles" resultType="com.blog.entity.Article">
        SELECT * FROM articles 
        WHERE status = 'PUBLISHED' 
        AND (title LIKE CONCAT('%', #{keyword}, '%') OR content LIKE CONCAT('%', #{keyword}, '%'))
        ORDER BY create_time DESC
    </select>

    <!-- 获取热门文章 -->
    <select id="selectPopularArticles" resultType="com.blog.entity.Article">
        SELECT * FROM articles 
        WHERE status = 'PUBLISHED' 
        ORDER BY view_count DESC 
        LIMIT #{limit}
    </select>

    <!-- 统计已发布文章数量 -->
    <select id="countPublishedArticles" resultType="long">
        SELECT COUNT(*) FROM articles WHERE status = 'PUBLISHED'
    </select>

    <!-- 增加文章访问量 -->
    <update id="incrementViewCount">
        UPDATE articles SET view_count = view_count + 1 WHERE id = #{id}
    </update>

</mapper>
