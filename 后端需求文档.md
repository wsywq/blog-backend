# 个人博客后端项目需求文档

## 1. 项目概述

### 1.1 项目名称
个人博客后端API服务 (Personal Blog Backend API)

### 1.2 项目目标
为个人博客前端项目提供完整的后端API服务，支持文章管理、用户认证、评论系统、访客统计、天气信息等功能。

### 1.3 技术栈
- **框架**: Spring Boot 3.x
- **语言**: Java 17
- **数据库**: MySQL 8.0
- **缓存**: Redis 6.x
- **认证**: JWT + GitHub OAuth
- **文档**: OpenAPI 3.0 (Swagger)
- **构建工具**: Maven
- **其他**: Spring Security, Spring Data JPA, Lombok

## 2. 功能需求

### 2.1 核心功能模块

#### 2.1.1 文章管理模块
- **文章CRUD**: 支持文章的增删改查操作
- **文章列表**: 分页查询文章列表，支持多种排序方式
- **文章详情**: 获取单篇文章的完整信息
- **文章分类**: 按分类筛选文章
- **文章标签**: 按标签筛选文章
- **文章搜索**: 支持标题和内容的全文搜索
- **访问量统计**: 记录和更新文章访问量
- **热门文章**: 按访问量获取热门文章列表

#### 2.1.2 用户认证模块
- **GitHub OAuth**: 集成GitHub第三方登录
- **JWT认证**: 基于JWT的用户认证和授权
- **用户信息管理**: 用户信息的存储和更新
- **登录状态管理**: 用户登录状态的维护

#### 2.1.3 评论系统模块
- **评论CRUD**: 支持评论的增删改查
- **评论列表**: 获取文章的评论列表
- **评论权限**: 登录用户才能发表评论
- **评论审核**: 支持评论的审核机制

#### 2.1.4 访客统计模块
- **访问量统计**: 记录网站总访问量
- **今日访问**: 统计今日访问量
- **访问趋势**: 提供访问量趋势数据
- **IP统计**: 记录访问者IP信息

#### 2.1.5 天气信息模块
- **天气API集成**: 集成第三方天气API
- **天气缓存**: 缓存天气信息减少API调用
- **位置服务**: 支持城市天气查询

#### 2.1.6 分类标签模块
- **分类管理**: 文章分类的增删改查
- **标签管理**: 文章标签的增删改查
- **分类统计**: 各分类下的文章数量统计
- **标签云**: 提供标签使用频率数据

### 2.2 API接口设计

#### 2.2.1 文章相关接口
```
GET    /api/articles              # 获取文章列表
GET    /api/articles/{id}         # 获取文章详情
POST   /api/articles              # 创建文章（管理员）
PUT    /api/articles/{id}         # 更新文章（管理员）
DELETE /api/articles/{id}         # 删除文章（管理员）
GET    /api/articles/category/{category}  # 按分类获取文章
GET    /api/articles/tag/{tag}    # 按标签获取文章
GET    /api/articles/search       # 搜索文章
PUT    /api/articles/{id}/view    # 更新文章访问量
GET    /api/articles/popular      # 获取热门文章
```

#### 2.2.2 用户相关接口
```
GET    /api/user/profile          # 获取用户信息
POST   /api/auth/github           # GitHub登录
POST   /api/auth/logout           # 退出登录
GET    /api/auth/refresh          # 刷新Token
```

#### 2.2.3 评论相关接口
```
GET    /api/comments/{articleId}  # 获取文章评论
POST   /api/comments              # 发表评论
PUT    /api/comments/{id}         # 更新评论
DELETE /api/comments/{id}         # 删除评论
```

#### 2.2.4 统计相关接口
```
GET    /api/stats/visitors        # 获取访客统计
GET    /api/stats/popular         # 获取热门文章统计
GET    /api/stats/categories      # 获取分类统计
GET    /api/stats/tags            # 获取标签统计
```

#### 2.2.5 天气相关接口
```
GET    /api/weather/current       # 获取当前天气
GET    /api/weather/forecast      # 获取天气预报
```

#### 2.2.6 分类标签接口
```
GET    /api/categories            # 获取所有分类
GET    /api/tags                  # 获取所有标签
```

## 3. 数据模型设计

### 3.1 核心实体

#### 3.1.1 文章实体 (Article)
```java
@Entity
public class Article {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @NotBlank
    private String title;
    
    @Lob
    @NotBlank
    private String content;
    
    @NotBlank
    private String summary;
    
    @NotBlank
    private String author;
    
    @Enumerated(EnumType.STRING)
    private ArticleStatus status;
    
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "category_id")
    private Category category;
    
    @ManyToMany
    @JoinTable(name = "article_tags")
    private Set<Tag> tags = new HashSet<>();
    
    private String coverImage;
    private Long viewCount = 0L;
    
    @CreatedDate
    private LocalDateTime createTime;
    
    @LastModifiedDate
    private LocalDateTime updateTime;
}
```

#### 3.1.2 用户实体 (User)
```java
@Entity
public class User {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @NotBlank
    private String username;
    
    private String email;
    private String avatar;
    private String githubId;
    
    @Enumerated(EnumType.STRING)
    private UserRole role = UserRole.USER;
    
    @CreatedDate
    private LocalDateTime createTime;
    
    @LastModifiedDate
    private LocalDateTime updateTime;
}
```

#### 3.1.3 评论实体 (Comment)
```java
@Entity
public class Comment {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "article_id")
    private Article article;
    
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "user_id")
    private User user;
    
    @NotBlank
    private String content;
    
    @Enumerated(EnumType.STRING)
    private CommentStatus status = CommentStatus.PENDING;
    
    @CreatedDate
    private LocalDateTime createTime;
}
```

#### 3.1.4 分类实体 (Category)
```java
@Entity
public class Category {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @NotBlank
    @Column(unique = true)
    private String name;
    
    private String description;
    private String icon;
    
    @CreatedDate
    private LocalDateTime createTime;
}
```

#### 3.1.5 标签实体 (Tag)
```java
@Entity
public class Tag {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @NotBlank
    @Column(unique = true)
    private String name;
    
    private String color;
    
    @CreatedDate
    private LocalDateTime createTime;
}
```

#### 3.1.6 访客统计实体 (VisitorStats)
```java
@Entity
public class VisitorStats {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    private String ipAddress;
    private String userAgent;
    private String referer;
    private String pageUrl;
    
    @CreatedDate
    private LocalDateTime visitTime;
}
```

### 3.2 枚举类型

#### 3.2.1 文章状态
```java
public enum ArticleStatus {
    DRAFT,      // 草稿
    PUBLISHED,  // 已发布
    ARCHIVED    // 已归档
}
```

#### 3.2.2 用户角色
```java
public enum UserRole {
    USER,       // 普通用户
    ADMIN       // 管理员
}
```

#### 3.2.3 评论状态
```java
public enum CommentStatus {
    PENDING,    // 待审核
    APPROVED,   // 已通过
    REJECTED    // 已拒绝
}
```

## 4. 非功能需求

### 4.1 性能要求
- API响应时间 < 500ms
- 支持并发用户数 > 1000
- 数据库查询优化，避免N+1问题
- 合理使用缓存减少数据库压力

### 4.2 安全要求
- 输入数据验证和清理
- SQL注入防护
- XSS防护
- CSRF防护
- JWT Token安全存储
- 敏感信息加密

### 4.3 可用性要求
- 系统可用性 > 99.9%
- 支持优雅降级
- 完善的错误处理和日志记录
- 健康检查接口

### 4.4 可维护性要求
- 清晰的代码结构和注释
- 统一的异常处理机制
- 完善的API文档
- 单元测试覆盖率 > 80%

## 5. 技术架构

### 5.1 分层架构
```
Controller Layer (REST API)
    ↓
Service Layer (Business Logic)
    ↓
Repository Layer (Data Access)
    ↓
Database Layer (MySQL + Redis)
```

### 5.2 安全架构
```
Client Request
    ↓
Spring Security Filter Chain
    ↓
JWT Authentication
    ↓
Authorization Check
    ↓
Controller Method
```

### 5.3 缓存策略
- Redis缓存热点数据
- 文章列表缓存
- 用户信息缓存
- 天气信息缓存

## 6. 部署要求

### 6.1 环境要求
- JDK 17+
- MySQL 8.0+
- Redis 6.0+
- Maven 3.6+

### 6.2 配置要求
- 环境变量配置
- 数据库连接池配置
- Redis连接配置
- 日志配置

### 6.3 监控要求
- 应用性能监控
- 数据库性能监控
- 错误日志监控
- 健康检查监控

## 7. 开发规范

### 7.1 代码规范
- 遵循阿里巴巴Java开发手册
- 使用Lombok减少样板代码
- 统一的命名规范
- 完善的注释文档

### 7.2 API规范
- RESTful API设计
- 统一的响应格式
- 合理的HTTP状态码
- 完整的错误信息

### 7.3 数据库规范
- 合理的表结构设计
- 适当的索引策略
- 数据完整性约束
- 分页查询优化

## 8. 测试策略

### 8.1 单元测试
- Service层业务逻辑测试
- Repository层数据访问测试
- 工具类方法测试

### 8.2 集成测试
- Controller层API测试
- 数据库集成测试
- 第三方服务集成测试

### 8.3 性能测试
- API响应时间测试
- 并发用户测试
- 数据库性能测试

## 9. 项目时间规划

### 9.1 第一阶段 (1周)
- 项目初始化和基础架构搭建
- 数据库设计和实体类创建
- 基础CRUD功能实现

### 9.2 第二阶段 (1周)
- 用户认证系统实现
- 文章管理功能完善
- 评论系统开发

### 9.3 第三阶段 (1周)
- 访客统计功能
- 天气信息集成
- 搜索功能实现

### 9.4 第四阶段 (1周)
- 性能优化和缓存
- 安全加固
- 测试和部署
